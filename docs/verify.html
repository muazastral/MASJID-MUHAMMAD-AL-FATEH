<!DOCTYPE html>
<html lang="ms">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pengesahan Sijil | Al-Fateh</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,500;0,700;1,500&display=swap"
    rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              gold: '#C5A065',
              dark: '#0F2412',
              light: '#F5F5F0',
              gray: '#8C8C8C'
            }
          },
          fontFamily: {
            'serif-display': ['"Playfair Display"', 'serif'],
            'serif-header': ['"Cinzel"', 'serif'],
            'sans-body': ['"Inter"', 'sans-serif'],
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6 font-sans-body">
  <div class="bg-white w-full max-w-xl p-8 rounded-2xl shadow-lg border border-gray-200 text-center">
    <div class="text-sm uppercase tracking-widest text-gray-400 mb-2">Pengesahan Sijil</div>
    <div class="flex items-center justify-center gap-2 mb-2">
      <span id="status-badge"
        class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-500">
        <span id="status-icon" class="w-4 h-4 inline-flex items-center justify-center">
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor" aria-hidden="true">
            <path
              d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 15a1 1 0 0 1-.707-.293l-3-3a1 1 0 1 1 1.414-1.414L12 14.586l4.293-4.293a1 1 0 1 1 1.414 1.414l-5 5A1 1 0 0 1 12 17Z" />
          </svg>
        </span>
        <span id="status-badge-text">Menunggu</span>
      </span>
    </div>
    <h2 id="status-title" class="text-2xl font-serif-header font-bold text-brand-dark mb-4">Memproses...</h2>
    <p id="status-desc" class="text-gray-600 mb-6">Sila tunggu sebentar.</p>

    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-left space-y-2">
      <div class="text-xs text-gray-500 uppercase">Nama</div>
      <div id="verify-name" class="font-semibold text-brand-dark">-</div>
      <div class="text-xs text-gray-500 uppercase mt-3">No. IC</div>
      <div id="verify-id" class="font-mono text-brand-dark">-</div>
      <div class="text-xs text-gray-500 uppercase mt-3">Nombor Pengesahan</div>
      <div id="verify-number" class="font-mono font-bold text-brand-dark">-</div>
    </div>

    <p class="text-[11px] text-gray-400 mt-6">Fail userlist.json perlu berada di folder <span class="font-semibold">/docs</span> untuk pengesahan automatik.</p>
  </div>

  <script>
    const els = {
      title: document.getElementById('status-title'),
      desc: document.getElementById('status-desc'),
      name: document.getElementById('verify-name'),
      id: document.getElementById('verify-id'),
      number: document.getElementById('verify-number'),
      badge: document.getElementById('status-badge'),
      badgeText: document.getElementById('status-badge-text'),
      icon: document.getElementById('status-icon')
    };

    function setStatus(ok, msg) {
      els.title.textContent = ok ? 'Sijil Disahkan' : 'Tidak Ditemui';
      els.desc.textContent = msg;
      els.title.classList.toggle('text-brand-dark', ok);
      els.title.classList.toggle('text-red-600', !ok);

      els.badge.classList.toggle('bg-green-100', ok);
      els.badge.classList.toggle('text-green-700', ok);
      els.badge.classList.toggle('bg-red-100', !ok);
      els.badge.classList.toggle('text-red-700', !ok);
      els.badgeText.textContent = ok ? 'Disahkan' : 'Tidak Sah';

      els.icon.innerHTML = ok
        ? '<svg viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 15a1 1 0 0 1-.707-.293l-3-3a1 1 0 1 1 1.414-1.414L12 14.586l4.293-4.293a1 1 0 1 1 1.414 1.414l-5 5A1 1 0 0 1 12 17Z" /></svg>'
        : '<svg viewBox="0 0 24 24" class="w-4 h-4" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm3.536 13.536a1 1 0 0 1-1.414 0L12 13.414l-2.121 2.122a1 1 0 1 1-1.415-1.415L10.586 12 8.464 9.879a1 1 0 1 1 1.415-1.415L12 10.586l2.122-2.122a1 1 0 1 1 1.414 1.415L13.414 12l2.122 2.121a1 1 0 0 1 0 1.415Z" /></svg>';
    }

    function parseQuery() {
      const params = new URLSearchParams(window.location.search || '');
      return {
        number: params.get('number') || '',
        name: params.get('name') || '',
        id: params.get('id') || ''
      };
    }

    function updateDisplay(data) {
      els.name.textContent = data.name || '-';
      els.id.textContent = data.id || '-';
      els.number.textContent = data.number || data.verify || '-';
    }

    async function loadUserList() {
      try {
        const res = await fetch('./userlist.json', { cache: 'no-store' });
        if (!res.ok) return [];
        return await res.json();
      } catch {
        return [];
      }
    }

    (async () => {
      const query = parseQuery();
      updateDisplay(query);

      if (!query.number && !query.name && !query.id) {
        setStatus(false, 'Parameter QR tidak sah atau tidak lengkap.');
        return;
      }

      const list = await loadUserList();
      if (!Array.isArray(list) || list.length === 0) {
        setStatus(false, 'Fail userlist.json tidak ditemui.');
        return;
      }

      const found = list.find(item => {
        const matchNumber = item.verify && query.number && item.verify === query.number;
        const matchId = item.id && query.id && item.id === query.id;
        const matchName = item.name && query.name && item.name.toLowerCase() === query.name.toLowerCase();
        return matchNumber && (matchId || matchName);
      });

      if (found) {
        updateDisplay({ name: found.name, id: found.id, number: found.verify });
        setStatus(true, 'Sijil ini adalah sah dan direkodkan.');
      } else {
        setStatus(false, 'Rekod tidak dijumpai dalam senarai pengesahan.');
      }
    })();
  </script>
</body>

</html>
